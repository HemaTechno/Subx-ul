<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Generator - Hema System</title>
    <style>
        /* ================= ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© (Dark Mode) ================= */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #1e1e1e;
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            border: 1px solid #333;
        }

        h2 { margin-bottom: 25px; color: #fff; font-size: 24px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· */
        .step-btn {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 18px;
            margin: 15px 0;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-sizing: border-box;
            color: white;
            position: relative;
            background-color: #3498db;
            box-shadow: 0 4px 0 #2980b9;
        }

        .step-btn:hover { transform: translateY(-2px); }
        .step-btn:active { transform: translateY(2px); box-shadow: none; }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Ø§Ù„Ø¹Ø¯Ø§Ø¯) */
        .step-waiting {
            background-color: #e67e22 !important;
            box-shadow: 0 4px 0 #d35400 !important;
            cursor: wait;
            pointer-events: none; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ØªÙƒØ±Ø± */
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„ */
        .step-locked {
            background-color: #333 !important;
            color: #777 !important;
            box-shadow: none !important;
            cursor: not-allowed;
            pointer-events: none;
            border: 1px solid #444;
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ */
        .step-done {
            background-color: #27ae60 !important;
            box-shadow: none !important;
            cursor: default;
            pointer-events: none;
        }

        /* Ø²Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙØªØ§Ø­ */
        #getKeyBtn {
            background-color: #8e44ad;
            box-shadow: 0 4px 0 #6c3483;
            display: none; /* Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
            animation: pulse 2s infinite;
        }
        #getKeyBtn:hover { background-color: #9b59b6; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(142, 68, 173, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(142, 68, 173, 0); }
            100% { box-shadow: 0 0 0 0 rgba(142, 68, 173, 0); }
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØªØ§Ø­ */
        #keyArea {
            display: none;
            margin-top: 25px;
            background: #252525;
            padding: 20px;
            border-radius: 15px;
            border: 2px dashed #f1c40f;
        }
        
        #generatedKey {
            font-family: 'Courier New', monospace;
            font-size: 22px;
            font-weight: bold;
            color: #f1c40f;
            letter-spacing: 2px;
            word-break: break-all;
            user-select: all;
            margin-top: 10px;
        }

        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .reset-link {
            display: inline-block;
            margin-top: 25px;
            font-size: 13px;
            color: #666;
            text-decoration: underline;
            cursor: pointer;
        }
        .reset-link:hover { color: #999; }
    </style>
</head>
<body>

    <div class="container">
        <h2>âš¡ Get Access Key</h2>

        <a id="btn1" href="https://www.youtube.com/@HemaTech_1" target="_blank" class="step-btn" onclick="startTimer(1, 'btn1')">
            1ï¸âƒ£ Subscribe Channel
        </a>
        
        <a id="btn2" href="https://www.youtube.com" target="_blank" class="step-btn" onclick="startTimer(2, 'btn2')">
            2ï¸âƒ£ Like Video
        </a>
        
        <a id="btn3" href="https://www.facebook.com" target="_blank" class="step-btn" onclick="startTimer(3, 'btn3')">
            3ï¸âƒ£ Join Group
        </a>

        <button id="getKeyBtn" class="step-btn" onclick="fetchKey()">
            <span>ğŸ”‘ GENERATE KEY (24H)</span>
            <div id="spinner" class="loading-spinner"></div>
        </button>

        <div id="keyArea">
            <span style="color:#aaa; font-size:14px;">Your Private Key:</span>
            <div id="generatedKey">Wait...</div>
            <p style="color:#555; font-size:12px; margin-top:5px;">Expires automatically in 24 hours.</p>
        </div>
        
        <br>
        <span class="reset-link" onclick="resetProgress()">Reset Progress (Test Mode)</span>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // ==============================================
        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (ÙŠØ¬Ø¨ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙƒ)
        // ==============================================
        const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8",
  storageBucket: "hhhhhh-d4fb8.appspot.com",
  messagingSenderId: "24512338206",
  appId: "1:24512338206:web:dfe045db59bd3434a2110f",
  measurementId: "G-HD4R7GNQ5H"
};

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // ==============================================
        // 3. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ØªØ§ÙŠÙ…Ø±
        // ==============================================
        const WAIT_SECONDS = 10; // Ù…Ø¯Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
        let currentProgress = localStorage.getItem('hemaUserProgress') || 0;
        currentProgress = parseInt(currentProgress);
        let isTimerRunning = false;

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
        let userId = localStorage.getItem('hemaUniqueUserID');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('hemaUniqueUserID', userId);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateUI();

        // --- Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ§ÙŠÙ…Ø± (Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ) ---
        function startTimer(stepNum, btnId) {
            // Ù„Ùˆ Ø§Ù„Ø®Ø·ÙˆØ© Ø®Ù„ØµØ§Ù†Ø© Ø£Ùˆ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø´ØºØ§Ù„ØŒ Ø§Ø®Ø±Ø¬
            if (stepNum <= currentProgress || isTimerRunning) return;

            isTimerRunning = true;
            let timeLeft = WAIT_SECONDS;
            const btn = document.getElementById(btnId);
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ø´ÙƒÙ„ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±
            btn.classList.remove('step-active');
            btn.classList.add('step-waiting');
            btn.innerText = `Verifying... ${timeLeft}s`;

            const countdown = setInterval(() => {
                timeLeft--;
                btn.innerText = `Verifying... ${timeLeft}s`;

                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    finishStep(stepNum); // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø·ÙˆØ©
                }
            }, 1000);
        }

        // --- Ø¯Ø§Ù„Ø© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø·ÙˆØ© ÙˆØ­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… ---
        function finishStep(stepNum) {
            isTimerRunning = false;
            if (stepNum > currentProgress) {
                currentProgress = stepNum;
                localStorage.setItem('hemaUserProgress', currentProgress);
                updateUI();
            }
        }

        // --- Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø§Ù„Ù‚ÙÙ„ ÙˆØ§Ù„ÙØªØ­) ---
        function updateUI() {
            const btn1 = document.getElementById('btn1');
            const btn2 = document.getElementById('btn2');
            const btn3 = document.getElementById('btn3');
            const getKeyBtn = document.getElementById('getKeyBtn');

            resetClass(btn1); resetClass(btn2); resetClass(btn3);

            // Step 1
            if (currentProgress >= 1) {
                btn1.classList.add('step-done');
                btn1.innerText = "1ï¸âƒ£ Subscribe: Done âœ“";
            } else {
                btn1.classList.add('step-active');
                if(!btn1.innerText.includes("Verifying")) btn1.innerText = "1ï¸âƒ£ Subscribe Channel";
            }

            // Step 2
            if (currentProgress >= 2) {
                btn2.classList.add('step-done');
                btn2.innerText = "2ï¸âƒ£ Like: Done âœ“";
            } else if (currentProgress == 1) {
                btn2.classList.add('step-active');
                if(!btn2.getAttribute('href')) btn2.setAttribute('href', "https://www.youtube.com"); // Ø§Ø³ØªØ±Ø¬Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·
                if(!btn2.innerText.includes("Verifying")) btn2.innerText = "2ï¸âƒ£ Like Video";
            } else {
                btn2.classList.add('step-locked');
                btn2.removeAttribute('href'); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù‚ÙÙ„
                btn2.innerText = "2ï¸âƒ£ Locked ğŸ”’";
            }

            // Step 3
            if (currentProgress >= 3) {
                btn3.classList.add('step-done');
                btn3.innerText = "3ï¸âƒ£ Join: Done âœ“";
                getKeyBtn.style.display = "flex"; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…ÙØªØ§Ø­
            } else if (currentProgress == 2) {
                btn3.classList.add('step-active');
                if(!btn3.getAttribute('href')) btn3.setAttribute('href', "https://www.facebook.com");
                if(!btn3.innerText.includes("Verifying")) btn3.innerText = "3ï¸âƒ£ Join Group";
            } else {
                btn3.classList.add('step-locked');
                btn3.removeAttribute('href');
                btn3.innerText = "3ï¸âƒ£ Locked ğŸ”’";
            }
        }

        function resetClass(elem) {
            if (!elem.classList.contains('step-waiting')) {
                elem.className = "step-btn"; 
            }
        }

        // ==============================================
        // 4. Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨/ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ø¹ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        // ==============================================
        async function fetchKey() {
            const btn = document.getElementById('getKeyBtn');
            const spinner = document.getElementById('spinner');
            const keyArea = document.getElementById('keyArea');
            const keyText = document.getElementById('generatedKey');

            btn.disabled = true;
            spinner.style.display = "inline-block";
            btn.querySelector('span').innerText = "CONNECTING...";

            try {
                const userRef = db.collection('keys').doc(userId);
                const doc = await userRef.get();
                let finalKey = "";

                if (doc.exists) {
                    const data = doc.data();
                    const now = new Date();
                    const expireDate = data.expireAt.toDate();

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙŠØ¶Ø§Ù‹
                    if (now < expireDate) {
                        finalKey = data.key;
                    } else {
                        // Ù„Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù†Ø¬Ø¯Ø¯Ù‡
                        finalKey = await createNewKey(userRef);
                    }
                } else {
                    // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                    finalKey = await createNewKey(userRef);
                }

                keyArea.style.display = "block";
                keyText.innerText = finalKey;
                btn.style.display = "none";

            } catch (error) {
                console.error("Error:", error);
                btn.querySelector('span').innerText = "ERROR! TRY AGAIN";
                btn.disabled = false;
                spinner.style.display = "none";
                alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!");
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ ÙˆØ­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø­Ø°Ù
        async function createNewKey(ref) {
            const newKey = generateRandomKey();
            const expireDate = new Date();
            expireDate.setHours(expireDate.getHours() + 24); // Ø¥Ø¶Ø§ÙØ© 24 Ø³Ø§Ø¹Ø©

            await ref.set({
                key: newKey,
                // Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ±Ø§Ù‚Ø¨Ù‡ ÙØ§ÙŠØ±Ø¨ÙŠØ² Ù„Ù„Ø­Ø°Ù
                expireAt: firebase.firestore.Timestamp.fromDate(expireDate)
            });
            return newKey;
        }

        function generateRandomKey() {
            const part = () => Math.random().toString(36).substr(2, 4).toUpperCase();
            return `HEMA-${part()}-${part()}-${part()}`;
        }

        function resetProgress() {
            localStorage.removeItem('hemaUserProgress');
            location.reload();
        }
    </script>

    <script src="https://publisher.linkvertise.com/cdn/linkvertise.js"></script>
    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙƒØ±Ø¨Øª: ÙŠØ±Ø§Ù‚Ø¨ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        linkvertise(1264869, {whitelist: [], blacklist: []});
    </script>

</body>
</html>
